







<!DOCTYPE HTML>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
  <title>雪球爬虫分析 - 记录-好好工作</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
  
  <title>雪球爬虫分析</title>
  <meta name="description" content="雪球平台无API接口，请求的数据均为渲染好的html数据。
账号注册需要手机验证，captcha可识度较低。
如果直接在这一步骤提取出数据可以使用BeautifulSoup库来简化操作，否则直接使用正则匹配出div中的a，形如/1287305957/66319002。域名为根域名，目前为xueqiu.com。
html = request.content HOST = &quot;http://xueqiu.com&quot; for div in html.body.div: uid = div[&#39;data-uid&#39;] did = div[&#39;data-id&#39;] # 该条数据的详情url detail_url = &quot;{}/{}/{}&quot;.format(HOST, uid, did) content = div.div[&#39;.status-bd&#39;][1].div[&#39;.status-content&#39;] detail_url = content[&#39;h4.status-title&gt;a&#39;][&#39;href&#39;] detail_title = content[&#39;h4.status-title&gt;a&#39;].text detail_content = content[&#39;div.detail&#39;].div[&#39;.text&#39;].html  未阅读消息接口
http://xueqiu.com/remind/unread.json?_=1458614506219  timeline接口
http://xueqiu.com/service/partials/home/timeline?since_id=66029490&amp;source=  登录接口
http://xueqiu.com/user/login POST username: areacode:86 telephone:15655400686 remember_me:1 password:028EA4876663F4D15EB5F3437101773B 其中password 为密码32位md5大写  所有接口无cookie会返回
{&quot;error_description&quot;:&quot;遇到错误，请刷新页面或者重新登录帐号后再试&quot;,&quot;error_uri&quot;:&quot;/stock/search.json&quot;,&quot;error_code&quot;:&quot;400016&quot;}  请求这个接口会设置以下cookie值，可请求其他接口
https://xueqiu.com/service/csrf?api=%2Fuser%2Flogin
Set-Cookie:s=23y213nb96; domain=.xueqiu.com; path=/; expires=Fri, 14 Apr 2017 11:29:00 GMT; httpOnly Set-Cookie:xq_is_login=; domain=xueqiu.">
  
  <meta name="author" content="">
  <meta name="keywords" content="">
  <link rel="icon" href="/favicon.png">
  
  
  <meta itemprop="name" content="雪球爬虫分析 - 记录-好好工作">
  <meta itemprop="description" content="雪球平台无API接口，请求的数据均为渲染好的html数据。
账号注册需要手机验证，captcha可识度较低。
如果直接在这一步骤提取出数据可以使用BeautifulSoup库来简化操作，否则直接使用正则匹配出div中的a，形如/1287305957/66319002。域名为根域名，目前为xueqiu.com。
html = request.content HOST = &quot;http://xueqiu.com&quot; for div in html.body.div: uid = div[&#39;data-uid&#39;] did = div[&#39;data-id&#39;] # 该条数据的详情url detail_url = &quot;{}/{}/{}&quot;.format(HOST, uid, did) content = div.div[&#39;.status-bd&#39;][1].div[&#39;.status-content&#39;] detail_url = content[&#39;h4.status-title&gt;a&#39;][&#39;href&#39;] detail_title = content[&#39;h4.status-title&gt;a&#39;].text detail_content = content[&#39;div.detail&#39;].div[&#39;.text&#39;].html  未阅读消息接口
http://xueqiu.com/remind/unread.json?_=1458614506219  timeline接口
http://xueqiu.com/service/partials/home/timeline?since_id=66029490&amp;source=  登录接口
http://xueqiu.com/user/login POST username: areacode:86 telephone:15655400686 remember_me:1 password:028EA4876663F4D15EB5F3437101773B 其中password 为密码32位md5大写  所有接口无cookie会返回
{&quot;error_description&quot;:&quot;遇到错误，请刷新页面或者重新登录帐号后再试&quot;,&quot;error_uri&quot;:&quot;/stock/search.json&quot;,&quot;error_code&quot;:&quot;400016&quot;}  请求这个接口会设置以下cookie值，可请求其他接口
https://xueqiu.com/service/csrf?api=%2Fuser%2Flogin
Set-Cookie:s=23y213nb96; domain=.xueqiu.com; path=/; expires=Fri, 14 Apr 2017 11:29:00 GMT; httpOnly Set-Cookie:xq_is_login=; domain=xueqiu.">
  <meta itemprop="image" content="img/author.jpg">
  
  
  <meta name="twitter:description" content="">
  
  <link rel="shortcut icon" href="img/favicon.ico"/>
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="apple-touch-icon.png" />

  
  <meta name="description" content="雪球平台无API接口，请求的数据均为渲染好的html数据。
账号注册需要手机验证，captcha可识度较低。
如果直接在这一步骤提取出数据可以使用BeautifulSoup库来简化操作，否则直接使用正则匹配出div中的a，形如/1287305957/66319002。域名为根域名，目前为xueqiu.com。
html = request.content HOST = &quot;http://xueqiu.com&quot; for div in html.body.div: uid = div[&#39;data-uid&#39;] did = div[&#39;data-id&#39;] # 该条数据的详情url detail_url = &quot;{}/{}/{}&quot;.format(HOST, uid, did) content = div.div[&#39;.status-bd&#39;][1].div[&#39;.status-content&#39;] detail_url = content[&#39;h4.status-title&gt;a&#39;][&#39;href&#39;] detail_title = content[&#39;h4.status-title&gt;a&#39;].text detail_content = content[&#39;div.detail&#39;].div[&#39;.text&#39;].html  未阅读消息接口
http://xueqiu.com/remind/unread.json?_=1458614506219  timeline接口
http://xueqiu.com/service/partials/home/timeline?since_id=66029490&amp;source=  登录接口
http://xueqiu.com/user/login POST username: areacode:86 telephone:15655400686 remember_me:1 password:028EA4876663F4D15EB5F3437101773B 其中password 为密码32位md5大写  所有接口无cookie会返回
{&quot;error_description&quot;:&quot;遇到错误，请刷新页面或者重新登录帐号后再试&quot;,&quot;error_uri&quot;:&quot;/stock/search.json&quot;,&quot;error_code&quot;:&quot;400016&quot;}  请求这个接口会设置以下cookie值，可请求其他接口
https://xueqiu.com/service/csrf?api=%2Fuser%2Flogin
Set-Cookie:s=23y213nb96; domain=.xueqiu.com; path=/; expires=Fri, 14 Apr 2017 11:29:00 GMT; httpOnly Set-Cookie:xq_is_login=; domain=xueqiu.">
  <meta property="og:description" content="雪球平台无API接口，请求的数据均为渲染好的html数据。
账号注册需要手机验证，captcha可识度较低。
如果直接在这一步骤提取出数据可以使用BeautifulSoup库来简化操作，否则直接使用正则匹配出div中的a，形如/1287305957/66319002。域名为根域名，目前为xueqiu.com。
html = request.content HOST = &quot;http://xueqiu.com&quot; for div in html.body.div: uid = div[&#39;data-uid&#39;] did = div[&#39;data-id&#39;] # 该条数据的详情url detail_url = &quot;{}/{}/{}&quot;.format(HOST, uid, did) content = div.div[&#39;.status-bd&#39;][1].div[&#39;.status-content&#39;] detail_url = content[&#39;h4.status-title&gt;a&#39;][&#39;href&#39;] detail_title = content[&#39;h4.status-title&gt;a&#39;].text detail_content = content[&#39;div.detail&#39;].div[&#39;.text&#39;].html  未阅读消息接口
http://xueqiu.com/remind/unread.json?_=1458614506219  timeline接口
http://xueqiu.com/service/partials/home/timeline?since_id=66029490&amp;source=  登录接口
http://xueqiu.com/user/login POST username: areacode:86 telephone:15655400686 remember_me:1 password:028EA4876663F4D15EB5F3437101773B 其中password 为密码32位md5大写  所有接口无cookie会返回
{&quot;error_description&quot;:&quot;遇到错误，请刷新页面或者重新登录帐号后再试&quot;,&quot;error_uri&quot;:&quot;/stock/search.json&quot;,&quot;error_code&quot;:&quot;400016&quot;}  请求这个接口会设置以下cookie值，可请求其他接口
https://xueqiu.com/service/csrf?api=%2Fuser%2Flogin
Set-Cookie:s=23y213nb96; domain=.xueqiu.com; path=/; expires=Fri, 14 Apr 2017 11:29:00 GMT; httpOnly Set-Cookie:xq_is_login=; domain=xueqiu.">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="雪球爬虫分析">
  <meta property="og:url" content="/w/post/2016-03-22-xueqiu-spider/">
  <meta property="og:site_name" content="记录-好好工作">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="记录-好好工作">
  <meta name="twitter:description" content="雪球平台无API接口，请求的数据均为渲染好的html数据。
账号注册需要手机验证，captcha可识度较低。
如果直接在这一步骤提取出数据可以使用BeautifulSoup库来简化操作，否则直接使用正则匹配出div中的a，形如/1287305957/66319002。域名为根域名，目前为xueqiu.com。
html = request.content HOST = &quot;http://xueqiu.com&quot; for div in html.body.div: uid = div[&#39;data-uid&#39;] did = div[&#39;data-id&#39;] # 该条数据的详情url detail_url = &quot;{}/{}/{}&quot;.format(HOST, uid, did) content = div.div[&#39;.status-bd&#39;][1].div[&#39;.status-content&#39;] detail_url = content[&#39;h4.status-title&gt;a&#39;][&#39;href&#39;] detail_title = content[&#39;h4.status-title&gt;a&#39;].text detail_content = content[&#39;div.detail&#39;].div[&#39;.text&#39;].html  未阅读消息接口
http://xueqiu.com/remind/unread.json?_=1458614506219  timeline接口
http://xueqiu.com/service/partials/home/timeline?since_id=66029490&amp;source=  登录接口
http://xueqiu.com/user/login POST username: areacode:86 telephone:15655400686 remember_me:1 password:028EA4876663F4D15EB5F3437101773B 其中password 为密码32位md5大写  所有接口无cookie会返回
{&quot;error_description&quot;:&quot;遇到错误，请刷新页面或者重新登录帐号后再试&quot;,&quot;error_uri&quot;:&quot;/stock/search.json&quot;,&quot;error_code&quot;:&quot;400016&quot;}  请求这个接口会设置以下cookie值，可请求其他接口
https://xueqiu.com/service/csrf?api=%2Fuser%2Flogin
Set-Cookie:s=23y213nb96; domain=.xueqiu.com; path=/; expires=Fri, 14 Apr 2017 11:29:00 GMT; httpOnly Set-Cookie:xq_is_login=; domain=xueqiu.">
  
  

  
  

  

  
  
  

  

  
  
    <link rel="stylesheet" href="https://zi.com/w/css/public.min.css">
  
  

  
  
  
  

  
    
  
</head>
<body>
    
        
    
    <div class="container">
        

<p>雪球平台无API接口，请求的数据均为渲染好的html数据。</p>

<p>账号注册需要手机验证，captcha可识度较低。</p>

<p>如果直接在这一步骤提取出数据可以使用BeautifulSoup库来简化操作，否则直接使用正则匹配出div中的a，形如<code>/1287305957/66319002</code>。域名为根域名，目前为<code>xueqiu.com</code>。</p>

<pre><code class="language-python">html = request.content
HOST = &quot;http://xueqiu.com&quot;

for div in html.body.div:
    uid            = div['data-uid']
    did            = div['data-id']
    # 该条数据的详情url
    detail_url     = &quot;{}/{}/{}&quot;.format(HOST, uid, did)
    content        = div.div['.status-bd'][1].div['.status-content']
    detail_url     = content['h4.status-title&gt;a']['href']
    detail_title   = content['h4.status-title&gt;a'].text
    detail_content = content['div.detail'].div['.text'].html
</code></pre>

<p>未阅读消息接口</p>

<pre><code>http://xueqiu.com/remind/unread.json?_=1458614506219
</code></pre>

<p>timeline接口</p>

<pre><code>http://xueqiu.com/service/partials/home/timeline?since_id=66029490&amp;source=
</code></pre>

<p>登录接口</p>

<pre><code>http://xueqiu.com/user/login

POST

username:
areacode:86
telephone:15655400686
remember_me:1
password:028EA4876663F4D15EB5F3437101773B

其中password 为密码32位md5大写

</code></pre>

<p>所有接口无cookie会返回</p>

<pre><code class="language-json">{&quot;error_description&quot;:&quot;遇到错误，请刷新页面或者重新登录帐号后再试&quot;,&quot;error_uri&quot;:&quot;/stock/search.json&quot;,&quot;error_code&quot;:&quot;400016&quot;}
</code></pre>

<p>请求这个接口会设置以下cookie值，可请求其他接口</p>

<p><a href="https://xueqiu.com/service/csrf?api=%2Fuser%2Flogin">https://xueqiu.com/service/csrf?api=%2Fuser%2Flogin</a></p>

<p>Set-Cookie:s=23y213nb96; domain=.xueqiu.com; path=/; expires=Fri, 14 Apr 2017 11:29:00 GMT; httpOnly
Set-Cookie:xq_is_login=; domain=xueqiu.com; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT
Set-Cookie:xq_a_token=b24582049f392ccbbbbd07ff7c20b1c642299e8c; domain=.xueqiu.com; path=/; httpOnly
Set-Cookie:xq_r_token=2ca7bd350f25ed0fab87c678da0e90b22cae3412; domain=.xueqiu.com; path=/; httpOnly</p>

<p>推荐内容</p>

<pre><code>
https://xueqiu.com/cubes/discover/rank/cube/list.json?category=12&amp;count=10&amp;market=cn&amp;profit=daily_gain

</code></pre>

<p>用户搜索接口</p>

<pre><code>http://xueqiu.com/users/search.json?q=%E4%BD%A0&amp;count=1&amp;sg=1
</code></pre>

<p>搜索建议接口</p>

<pre><code>http://xueqiu.com/users/search/suggest.json?q=%E4%BD%A0&amp;count=3

https://xueqiu.com/stock/search.json?code=z&amp;size=5&amp;key=47bce5c74f

https://xueqiu.com/imgroups/search.json?q=z&amp;count=3&amp;sg=1
</code></pre>

<p>查看用户</p>

<pre><code>http://xueqiu.com/user/show.json?id=%E7%BE%8E%E4%B8%BD%E7%9A%84%E5%BF%83%E4%B8%AD%E6%9C%89%E4%B8%80&amp;_=1458710552921
</code></pre>

<p>关注接口</p>

<pre><code>http://xueqiu.com/service/poster

POST

url:/friendships/create/1492448550.json
data[remark]:true
data[_]:1458621400786
</code></pre>

<p>取消关注</p>

<pre><code>http://xueqiu.com/service/poster

POST

url:/friendships/destroy/1492448550.json
data[_]:1458622520646
</code></pre>

<p>获取提交token</p>

<pre><code>http://xueqiu.com/service/csrf?api=%2Ffriendships%2Fgroups%2Fcreate.json&amp;_=1458621499235
</code></pre>

<p>获取所有组</p>

<pre><code>http://xueqiu.com/friendships/groups.json?_=1458621401004
</code></pre>

<p>新建分组</p>

<pre><code>http://xueqiu.com/service/poster

POST

url:/friendships/groups/create.json
data[name]:11111
data[_]:1458621499234
session_token:hyBEKZE56V1AjK5ziMsmX
</code></pre>

<p>添加组成员</p>

<pre><code>http://xueqiu.com/service/poster

POST

url:/friendships/groups/members/add.json
data[uid]:1492448550
data[gid]:12984431
data[_]:1458621594310
session_token:joGyDELD4xSjdzf8tfd6pt
</code></pre>

<h3 id="拟定数据库">拟定数据库</h3>

<h4 id="账号表-accounts">账号表-accounts</h4>

<p>id
weixin_id
weibo_id
qq_id
email
phone
nickname
pwd
encodepwd
cookie
status({0: &lsquo;normal&rsquo;, -1: &lsquo;drop&rsquo;, 2: &lsquo;relogin&rsquo;, 3: &lsquo;reject&rsquo;})
lastid</p>

<h4 id="关注目标表-targets">关注目标表-targets</h4>

<p>id
uid
nickname
byid</p>

<h4 id="内容表">内容表</h4>

<p>id
uid
cid
ctime
atime
title
content</p>

    </div>
</body>

  

</html>